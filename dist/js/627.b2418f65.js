"use strict";(self["webpackChunkpanel"]=self["webpackChunkpanel"]||[]).push([[627],{7627:function(e,t,o){o.r(t),o.d(t,{default:function(){return oe}});var s=o(641),l=o(3751),a=o(33);const n={class:"main-content"},i={class:"container-fluid"},r={class:"row justify-content-center"},d={class:"col-12 col-lg-10 col-xl-8"},c={class:"row"},u={class:"col-12 col-md-6"},p={class:"form-group"},m={class:"col-12 col-md-6"},h={class:"form-group"},v={class:"col-12 col-md-6"},f={class:"form-group"},g={class:"col-12 col-md-6"},b={class:"form-group"},k={class:"row"},L={class:"col-12 col-md-6"},x={class:"form-group"},y={class:"col-12 col-md-6"},I={class:"form-group"},C=["value"],_={class:"col-12 col-md-6"},w={class:"form-group"},O={class:"col-12 col-md-6"},$={class:"form-group"},A={class:"col-md-6"},T={class:"card"},S={class:"table-responsive mb-0"},N={class:"table table-sm table-nowrap card-table"},E={key:0,class:"fs-base"},V={datetime:"2020-04-24"},M=["onClick"],j={key:1,class:"fs-base"};function F(e,t,o,F,D,R){const P=(0,s.g2)("sideBar"),U=(0,s.g2)("topNav"),X=(0,s.g2)("model-select");return(0,s.uX)(),(0,s.CE)("div",null,[(0,s.bF)(P),(0,s.Lk)("div",n,[(0,s.bF)(U),(0,s.Lk)("div",i,[(0,s.Lk)("div",r,[(0,s.Lk)("div",d,[t[32]||(t[32]=(0,s.Fv)('<div class="header mt-md-5"><div class="header-body"><div class="row align-items-center"><div class="col"><h6 class="header-pretitle">Panel de administración</h6><h1 class="header-title">Nuevo Ingreso</h1></div></div><div class="row align-items-center"><div class="col"><ul class="nav nav-tabs nav-overflow header-tabs"><li class="nav-item"><a class="nav-link"> Ingresos </a></li><li class="nav-item"><a class="nav-link active">Nuevo ingreso </a></li></ul></div></div></div></div>',1)),(0,s.Lk)("div",c,[(0,s.Lk)("div",u,[(0,s.Lk)("div",p,[t[11]||(t[11]=(0,s.Lk)("label",{class:"form-label"}," Proveedor ",-1)),t[12]||(t[12]=(0,s.Lk)("small",{class:"form-text text-muted"}," Proveedor encargado del ingreso. ",-1)),(0,s.bo)((0,s.Lk)("select",{class:"form-select mb-3","onUpdate:modelValue":t[0]||(t[0]=e=>D.ingreso.proveedor=e)},t[10]||(t[10]=[(0,s.Lk)("option",{value:"",selected:"",disable:""},"Seleccionar",-1),(0,s.Lk)("option",null,"Red marin",-1),(0,s.Lk)("option",null,"Otro",-1)]),512),[[l.u1,D.ingreso.proveedor]])])]),(0,s.Lk)("div",m,[(0,s.Lk)("div",h,[t[13]||(t[13]=(0,s.Lk)("label",{class:"form-label"}," N° comprobante ",-1)),t[14]||(t[14]=(0,s.Lk)("small",{class:"form-text text-muted"}," Número de la factura. ",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control",placeholder:"5DSF-000154","onUpdate:modelValue":t[1]||(t[1]=e=>D.ingreso.ncomprobante=e)},null,512),[[l.Jo,D.ingreso.ncomprobante]])])]),(0,s.Lk)("div",v,[(0,s.Lk)("div",f,[t[15]||(t[15]=(0,s.Lk)("label",{class:"form-label"}," Monto total ",-1)),t[16]||(t[16]=(0,s.Lk)("small",{class:"form-text text-muted"}," Monto total pagado al proveedor. ",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control",placeholder:"546","onUpdate:modelValue":t[2]||(t[2]=e=>D.ingreso.monto_total=e)},null,512),[[l.Jo,D.ingreso.monto_total]])])]),(0,s.Lk)("div",g,[(0,s.Lk)("div",b,[t[17]||(t[17]=(0,s.Lk)("label",{class:"form-label"}," Comprobante ",-1)),t[18]||(t[18]=(0,s.Lk)("small",{class:"form-text text-muted"}," Selecciona el comprobante del ingreso.(requerido) ",-1)),(0,s.Lk)("input",{type:"file",class:"form-control",onChange:t[3]||(t[3]=e=>R.uploadComprobante(e))},null,32)])])]),t[33]||(t[33]=(0,s.Lk)("hr",{class:"my-5"},null,-1)),(0,s.Lk)("div",k,[t[28]||(t[28]=(0,s.Lk)("div",{class:"col-md-12 mb-4"},[(0,s.Lk)("h3",null,[(0,s.Lk)("b",null,"Productos del ingreso")])],-1)),(0,s.Lk)("div",L,[(0,s.Lk)("div",x,[t[19]||(t[19]=(0,s.Lk)("label",{class:"form-label"}," Producto ",-1)),t[20]||(t[20]=(0,s.Lk)("small",{class:"form-text text-muted"}," Selecciona el producto ",-1)),(0,s.bF)(X,{options:D.productos,modelValue:D.producto,"onUpdate:modelValue":[t[4]||(t[4]=e=>D.producto=e),R.producto_selected],"selected-option":D.producto,placeholder:"Selecciona el producto"},null,8,["options","modelValue","selected-option","onUpdate:modelValue"])])]),(0,s.Lk)("div",y,[(0,s.Lk)("div",I,[t[22]||(t[22]=(0,s.Lk)("label",{class:"form-label"}," Variedad ",-1)),t[23]||(t[23]=(0,s.Lk)("small",{class:"form-text text-muted"}," Selecciona la variedad ",-1)),(0,s.bo)((0,s.Lk)("select",{class:"form-select mb-3","onUpdate:modelValue":t[5]||(t[5]=e=>D.detalle.variedad=e)},[t[21]||(t[21]=(0,s.Lk)("option",{value:"",selected:"",disable:""},"Seleccionar",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(D.variedades,(e=>((0,s.uX)(),(0,s.CE)("option",{value:e._id},(0,a.v_)(e.color.toUpperCase())+" - "+(0,a.v_)(e.talla.toUpperCase())+" - "+(0,a.v_)(e.stock),9,C)))),256))],512),[[l.u1,D.detalle.variedad]])])]),(0,s.Lk)("div",_,[(0,s.Lk)("div",w,[t[24]||(t[24]=(0,s.Lk)("label",{class:"form-label"}," Precio unidad ",-1)),t[25]||(t[25]=(0,s.Lk)("small",{class:"form-text text-muted"}," Ingresa el precio por unidad ",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control mb-3",placeholder:"0.00","onUpdate:modelValue":t[6]||(t[6]=e=>D.detalle.precio_unidad=e)},null,512),[[l.Jo,D.detalle.precio_unidad]])])]),(0,s.Lk)("div",O,[(0,s.Lk)("div",$,[t[26]||(t[26]=(0,s.Lk)("label",{class:"form-label"}," Cantidad total ",-1)),t[27]||(t[27]=(0,s.Lk)("small",{class:"form-text text-muted"}," Ingresa cantidad de unidades que ingresan al stock ",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",class:"form-control mb-3",placeholder:"0","onUpdate:modelValue":t[7]||(t[7]=e=>D.detalle.cantidad=e)},null,512),[[l.Jo,D.detalle.cantidad]])])]),(0,s.Lk)("div",A,[(0,s.Lk)("button",{class:"btn btn-primary",style:{"margin-bottom":"1.8rem!important"},onClick:t[8]||(t[8]=e=>R.agregar_detalle())}," Agregar ")])]),(0,s.Lk)("div",T,[(0,s.Lk)("div",S,[(0,s.Lk)("table",N,[t[31]||(t[31]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Producto:"),(0,s.Lk)("th",null,"Precio unidad:"),(0,s.Lk)("th",null,"Cantidad:"),(0,s.Lk)("th",null,"Subtotal:"),(0,s.Lk)("th")])],-1)),D.detalles.length>=1?((0,s.uX)(),(0,s.CE)("tbody",E,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(D.detalles,((e,t)=>((0,s.uX)(),(0,s.CE)("tr",null,[(0,s.Lk)("td",null,[(0,s.Lk)("a",null,(0,a.v_)(e.titulo_producto),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("time",V,(0,a.v_)(R.convertCurrency(e.precio_unidad)),1)]),(0,s.Lk)("td",null,(0,a.v_)(e.cantidad),1),(0,s.Lk)("td",null,(0,a.v_)(R.convertCurrency(e.precio_unidad*e.cantidad)),1),(0,s.Lk)("td",null,[(0,s.Lk)("button",{class:"btn btn-danger btn-sm",onClick:o=>R.eliminar_detalle(t,e.precio_unidad*e.cantidad)},"Quitar",8,M)])])))),256))])):(0,s.Q3)("",!0),0==D.detalles.length?((0,s.uX)(),(0,s.CE)("tbody",j,t[29]||(t[29]=[(0,s.Lk)("tr",null,[(0,s.Lk)("td",{class:"text-center",colspan:"5"},[(0,s.Lk)("span",{class:"text-muted"},"No se han agregado detalles en el ingreso")])],-1)]))):(0,s.Q3)("",!0),(0,s.Lk)("tfoot",null,[(0,s.Lk)("tr",null,[t[30]||(t[30]=(0,s.Lk)("td",{colspan:"4"},"Total:",-1)),(0,s.Lk)("td",null,(0,a.v_)(R.convertCurrency(D.total)),1)])])])])]),(0,s.Lk)("button",{class:"btn btn-primary mb-7",onClick:t[9]||(t[9]=e=>R.registro_ingreso())}," Ingresar datos ")])])])])])}var D=o(8554),R=o(786);const P={openOptions(e){e.$refs.input.focus(),e.showMenu=!0,e.mousedownState=!1},blurInput(e){e.mousedownState||(e.searchText="",e.closeOptions()),e.$emit("blur")},closeOptions(e){e.$refs.input.blur(),e.showMenu=!1},prevItem(e){const t=e.pointer-1,o=e.$el.offsetHeight*t;t>=0&&(e.pointer=t),e.$refs.menu.scrollTop=o},nextItem(e){const t=e.pointer+1,o=e.$el.offsetHeight*t;t<=e.filteredOptions.length-1&&(e.pointer=t);const s=e.$refs.menu.offsetHeight,l=Math.ceil((e.$refs.menu.scrollTop+e.$el.offsetHeight)/s),a=Math.ceil(o/s);l!==a&&(e.$refs.menu.scrollTop=(a-1)*e.$refs.menu.offsetHeight)},enterItem(e){const t=e.filteredOptions[e.pointer],o=t.disabled;t&&!o&&e.selectItem(t)},pointerSet(e,t){e.pointer=t},pointerAdjust(e){e.pointer>=e.filteredOptions.length-1&&(e.pointer=e.filteredOptions.length?e.filteredOptions.length-1:0)},mousedownItem(e){e.mousedownState=!0}};function U(e){return new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i")}const X={props:{id:{default:null},name:{type:String,default:""},isError:{type:Boolean,default:!1},customAttr:{type:Function,default:()=>""},isDisabled:{type:Boolean,default:!1},placeholder:{type:String,default:""},filterPredicate:{type:Function,default:(e,t)=>e.match(U(t))}}},B=(e,t)=>{const o=e.__vccOpts||e;for(const[s,l]of t)o[s]=l;return o},H={name:"ModelSelect",mixins:[X],emits:["blur","searchchange","update:modelValue"],props:{modelValue:{type:[String,Number,Object,Boolean]},customAttr:{type:Function,default:()=>""},options:{type:Array}},data(){return{showMenu:!1,searchText:"",mousedownState:!1,pointer:-1}},watch:{value(e){this.pointer=this.filteredOptions.findIndex((t=>t.value===this.optionValue(e)))},filteredOptions(){this.pointerAdjust()},searchText(){this.$emit("searchchange",this.searchText)}},computed:{searchTextCustomAttr(){return this.selectedOption&&this.selectedOption.value?this.customAttr(this.selectedOption):""},inputText(){if(this.searchText)return"";{let e=this.placeholder;return this.selectedOption&&(e=this.selectedOption.text),e}},customAttrs(){try{if(Array.isArray(this.options))return this.options.map((e=>this.customAttr(e)))}catch{}return[]},textClass(){return!this.selectedOption&&this.placeholder?"default":""},menuClass(){return{visible:this.showMenu,hidden:!this.showMenu}},menuStyle(){return{display:this.showMenu?"block":"none"}},filteredOptions(){return this.searchText?this.options.filter((e=>{try{return this.filterPredicate(e.text,this.searchText)}catch{return!0}})):this.options},selectedOption(){return this.options.find((e=>e.value===this.optionValue(this.modelValue)))}},methods:{deleteTextOrItem(){!this.searchText&&this.modelValue&&(this.selectItem({}),this.openOptions())},openOptions(){P.openOptions(this)},blurInput(){P.blurInput(this)},closeOptions(){P.closeOptions(this)},prevItem(){P.prevItem(this)},nextItem(){P.nextItem(this)},enterItem(){P.enterItem(this)},pointerSet(e){P.pointerSet(this,e)},pointerAdjust(){P.pointerAdjust(this)},mousedownItem(){P.mousedownItem(this)},selectItem(e){this.searchText="",this.closeOptions(),"object"==typeof this.modelValue&&this.modelValue?this.$emit("update:modelValue",e):(this.$emit("update:modelValue",e.value),void 0!==e.value&&e.value===e.text&&(this.searchText=e.value))},optionValue(e){return"object"==typeof e&&null!==e?e.value:e}}},J=(0,s.Lk)("i",{class:"dropdown icon"},null,-1),K=["disabled","tabindex","id","name","value"],z=["data-vss-custom-attr"],Q=["data-vss-custom-attr","onClick","onMouseenter"];function q(e,t,o,n,i,r){return(0,s.uX)(),(0,s.CE)("div",{class:(0,a.C4)(["ui fluid search selection dropdown",{"active visible":i.showMenu,error:e.isError,disabled:e.isDisabled}]),onClick:t[11]||(t[11]=(...e)=>r.openOptions&&r.openOptions(...e)),onFocus:t[12]||(t[12]=(...e)=>r.openOptions&&r.openOptions(...e))},[J,(0,s.Lk)("input",{class:"search",autocomplete:"off",disabled:e.isDisabled,tabindex:e.isDisabled?-1:0,id:e.id,name:e.name,value:i.searchText,onInput:t[0]||(t[0]=e=>i.searchText=e.target.value),ref:"input",onFocus:t[1]||(t[1]=(0,l.D$)(((...e)=>r.openOptions&&r.openOptions(...e)),["prevent"])),onKeyup:[t[2]||(t[2]=(0,l.jR)(((...e)=>r.closeOptions&&r.closeOptions(...e)),["esc"])),t[7]||(t[7]=(0,l.jR)((0,l.D$)(((...e)=>r.enterItem&&r.enterItem(...e)),["prevent"]),["enter"]))],onBlur:t[3]||(t[3]=(...e)=>r.blurInput&&r.blurInput(...e)),onKeydown:[t[4]||(t[4]=(0,l.jR)(((...e)=>r.prevItem&&r.prevItem(...e)),["up"])),t[5]||(t[5]=(0,l.jR)(((...e)=>r.nextItem&&r.nextItem(...e)),["down"])),t[6]||(t[6]=(0,l.jR)((0,l.D$)((()=>{}),["prevent"]),["enter"])),t[8]||(t[8]=(0,l.jR)(((...e)=>r.deleteTextOrItem&&r.deleteTextOrItem(...e)),["delete"]))]},null,40,K),(0,s.Lk)("div",{class:(0,a.C4)(["text",r.textClass]),"data-vss-custom-attr":r.searchTextCustomAttr},(0,a.v_)(r.inputText),11,z),(0,s.Lk)("div",{class:(0,a.C4)(["menu",r.menuClass]),ref:"menu",onMousedown:t[10]||(t[10]=(0,l.D$)((()=>{}),["prevent"])),style:(0,a.Tr)(r.menuStyle),tabindex:"-1"},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.filteredOptions,((o,n)=>((0,s.uX)(),(0,s.CE)("div",{key:n,class:(0,a.C4)(["item",{selected:o.selected||i.pointer===n,disabled:o.disabled}]),"data-vss-custom-attr":r.customAttrs[n]?r.customAttrs[n]:"",onClick:(0,l.D$)((e=>r.selectItem(o)),["stop"]),onMousedown:t[9]||(t[9]=(...e)=>r.mousedownItem&&r.mousedownItem(...e)),onMouseenter:e=>r.pointerSet(n)},[(0,s.RG)(e.$slots,"default",{option:o,idx:n},(()=>[(0,s.eW)((0,a.v_)(o.text),1)]))],42,Q)))),128))],38)],34)}const G=B(H,[["render",q]]);Boolean,Boolean,Boolean;var W=o(4335),Y=o(4329),Z={name:"crearIngresoApp",data(){return{ingreso:{proveedor:""},detalle:{variedad:""},detalles:[],comprobante:void 0,producto:[],productos:[],variedades:[],total:0}},methods:{uploadComprobante(e){var t;e.target.files.length>=1&&(t=e.target.files[0]),t.size<=1e6?"image/jpg"==t.type||"image/png"==t.type||"image/webp"==t.type||"image/jpeg"==t.type||"application/pdf"==t.type?(this.comprobante=t,this.ingreso.documento=this.comprobante):(this.$notify({title:"ATENCIÓN",text:"Solo se admiten imagenes o archivo PDF.",type:"warn"}),this.ingreso.documento=void 0,this.comprobante=void 0):(this.$notify({title:"ATENCIÓN",text:"El archivo no debe ser mayor a 1mb.",type:"warn"}),this.ingreso.documento=void 0,this.comprobante=void 0),console.log(this.ingreso.documento)},init_productos(){this.productos=[],W.A.get(this.$url+"/listar_productos_activos_admin",{headers:{"Content-Type":"application/json",Authorization:this.$store.state.token}}).then((e=>{for(var t of e.data)this.productos.push({value:t._id,text:t.nombre})}))},producto_selected(e){this.producto=e,this.init_variedades(e.value),this.detalle.producto=e.value,this.detalle.titulo_producto=e.text},init_variedades(e){W.A.get(this.$url+"/obtener_variedades_producto/"+e,{headers:{"Content-Type":"application/json",Authorization:this.$store.state.token}}).then((e=>{this.variedades=e.data}))},agregar_detalle(){if(this.detalle.producto)if(this.detalle.variedad)if(this.detalle.precio_unidad)if(this.detalle.cantidad){this.detalles.push(this.detalle);let e=this.detalle.precio_unidad*this.detalle.cantidad;this.total=this.total+e,this.detalle={variedad:""},this.producto={}}else this.$notify({title:"ATENCIÓN",text:"Ingrese la cantidad a agredar",type:"warn"});else this.$notify({title:"ATENCIÓN",text:"Ingrese el precio por unidad",type:"warn"});else this.$notify({title:"ATENCIÓN",text:"Selecciona la variedad",type:"warn"});else this.$notify({title:"ATENCIÓN",text:"Selecciona un producto",type:"warn"});console.log(this.detalles)},convertCurrency(e){return Y.format(e,{code:"MXN"})},eliminar_detalle(e,t){this.detalles.splice(e,1),this.total=this.total-t},registro_ingreso(){this.ingreso.documento="",this.ingreso.proveedor?this.ingreso.ncomprobante?this.ingreso.monto_total?this.ingreso.documento?this.conexion_registro():this.$notify({title:"ATENCIÓN",text:"Agrega una factura al ingreso",type:"warn"}):this.$notify({title:"ATENCIÓN",text:"Ingrese el monto total",type:"warn"}):this.$notify({title:"ATENCIÓN",text:"Ingrese el numero del comprobante",type:"warn"}):this.$notify({title:"ATENCIÓN",text:"Seleccione el proveedor ",type:"warn"})},conexion_registro(){var e=new FormData;e.append("proveedor",this.ingreso.proveedor),e.append("ganancia",this.$ganancia),e.append("ncomprobante",this.ingreso.ncomprobante),e.append("monto_total",this.ingreso.monto_total),e.append("monto_resultante",this.total),e.append("documento",this.ingreso.documento),e.append("detalles",JSON.stringify(this.detalles)),W.A.post(this.$url+"/registro_ingresos_admin",e,{headers:{"Content-Type":"multipart/form-data",Authorization:this.$store.state.token}}).then((e=>{e.data.message?this.$notify({title:"ERROR",text:e.data.message,type:"error"}):(console.log(e),this.$notify({title:"SUCCESS",text:"Se registro el ingreso",type:"success"}))})).catch((e=>{console.log(e)}))}},beforeMount(){this.init_productos()},components:{sideBar:D.A,topNav:R.A,ModelSelect:G}},ee=o(6262);const te=(0,ee.A)(Z,[["render",F]]);var oe=te}}]);
//# sourceMappingURL=627.b2418f65.js.map